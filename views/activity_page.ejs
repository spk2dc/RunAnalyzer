<!DOCTYPE html>
<html lang="en">

<% let activity = user.detailedActivities[activityID] %>

<head>
    <%- include ('./partials/head.ejs') %>

    <title><%= user.firstname %>'s <%= activity.type %></title>
</head>

<%

//calculations for table values that are not properties

let total_time = new Date(1000 * activity.elapsed_time).toISOString().substr(11, 8)
let moving_time = new Date(1000 * activity.moving_time).toISOString().substr(11, 8)
let km = activity.distance/1000
let mi = activity.distance/1000*0.621371
let paceSecKM = activity.moving_time/km
let paceMinKM = new Date(1000 * paceSecKM).toISOString().substr(14, 5)
let paceSecMI = activity.moving_time/mi
let paceMinMI = new Date(1000 * paceSecMI).toISOString().substr(14, 5)

%>

<body>
    <h1><%= activity.name %></h1>

    <form action="/user_overview" method="get">
        <button type="submit" class="btn btn-primary">Back to Overview Page</button>
    </form>
    
    <br>
    <h3>Date:
        <%= new Date(activity.start_date_local).toLocaleDateString('en-US', { year: 'numeric', month: '2-digit', day: '2-digit' }) %>
    </h3>
    <h3>Start Time:
        <%= new Date(activity.start_date_local).toLocaleTimeString('en-US', { hour: '2-digit', minute: '2-digit', second: '2-digit' }) %>
    </h3>
    <h3>Activity Type: <%= activity.type %></h3>
    <h3>Total Time: <%= total_time %></h3>
    <h3>Moving Time: <%= moving_time %></h3>
    <h3>Average Speed (m/s): <%= activity.average_speed %></h3>
    <h3>Max Speed (m/s): <%= activity.max_speed %></h3>
    <h3>Elevation Gain (m): <%= activity.total_elevation_gain %></h3>
    <h3>Custom Note: <%= activity.customNote %></h3>
    <form action="/activity/<%= activityID %>/note" method="get">
        <button type="submit" class="btn btn-success">Edit Custom Note</button>
    </form>

    <br>
    <h3><a href="https://www.strava.com/activities/<%= activity.id %>" class="btn btn-info">View activity in Strava</a></h3>
    <br>
    <h3>METRIC</h3>
    <h3>KMs: <%= km.toFixed(2) %></h3>
    <h3>Pace (min/km): <%= paceMinKM %></h3>
    <h3>Splits</h3>
    <table class="table table-striped table-sm">
        <thead>
            <th>KMs #</th>
            <th>Total Time (min)</th>
            <th>Average Speed (min/km)</th>
            <th>Elevation (m)</th>
        </thead>
        <tbody>
            <% for(const split of activity.splits_standard) { %>
                <%
                let splitKM = split.distance/1000
                let splitPaceSecKM = split.moving_time/splitKM
                let splitPaceMinKM = new Date(1000 * splitPaceSecKM).toISOString().substr(14, 5)
                %>

                <tr>
                    <td><% if(Math.round(splitKM) != 1) { %>
                            <%= splitKM.toFixed(2) %>
                        <% } else { %>
                            <%= split.split %>
                        <% } %>
                        </td>
                    <td><%= new Date(1000 * split.elapsed_time).toISOString().substr(14, 5) %></td>
                    <td><%= splitPaceMinKM %></td>
                    <td><%= split.elevation_difference %></td>

                </tr>
            <% } %>
        </tbody>
    </table>
    <br>


    <h3>US CUSTOMARY</h3>
    <h3>Miles: <%= mi.toFixed(2) %></h3>
    <%  %>
    <h3>Pace (min/mi): <%= paceMinMI %></h3>
    <h3>Splits</h3>
    <table class="table table-striped table-sm" >
        <thead>
            <th>Mile #</th>
            <th>Total Time (min)</th>
            <th>Average Speed (min/mi)</th>
            <th>Elevation (m)</th>
        </thead>
        <tbody>
            <% for(const split of activity.splits_standard) { %>
                <%
                let splitMI = split.distance/1000*0.621371
                let splitPaceSecMI = split.moving_time/splitMI
                let splitPaceMinMI = new Date(1000 * splitPaceSecMI).toISOString().substr(14, 5)
                %>

                <tr>
                    <td><% if(Math.round(splitMI) != 1) { %>
                            <%= splitMI.toFixed(2) %>
                        <% } else { %>
                            <%= split.split %>
                        <% } %>
                        </td>
                    <td><%= new Date(1000 * split.elapsed_time).toISOString().substr(14, 5) %></td>
                    <td><%= splitPaceMinMI %></td>
                    <td><%= split.elevation_difference %></td>

                </tr>
            <% } %>
        </tbody>
    </table>





    <%- include ('./partials/bootstrap_scripts.ejs') %>
</body>

</html>